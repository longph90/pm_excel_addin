!function(){"use strict";!function(){function e(e){var t=new Date(e);return 25569+(t.getTime()-60*t.getTimezoneOffset()*1e3)/864e5}function t(e){return!e||isNaN(e)?"":new Date(86400*(e-25569)*1e3).toISOString().split("T")[0]}function n(e,t){var n=document.getElementById("notification");n.textContent=e,n.className="alert alert-".concat(t," position-fixed bottom-0 start-50 translate-middle-x mb-3"),n.classList.remove("d-none"),setTimeout((function(){n.classList.add("d-none")}),3e3)}var a=Object.freeze({OPEN:"OPEN",IN_PROGRESS:"IN_PROGRESS",WAITING_REVIEW:"WAITING_REVIEW",WAITING_RELEASE:"WAITING_RELEASE",RELEASED:"RELEASED"});function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t,n){return(t=function(e){var t=function(e){if("object"!=r(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==r(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function c(e){Excel.run((function(a){var r=a.workbook.worksheets.getItem("WBS").tables.getItem("TblWbs").getDataBodyRange();return r.load("values"),a.sync().then((function(){var a=r.values.find((function(t){return t[0]===e}));a?(document.querySelector("#progressForm #progressTaskID").value=e,document.querySelector("#progressForm #aStartDate").value=t(a[9]),document.querySelector("#progressForm #aEndDate").value=t(a[10]),document.querySelector("#progressForm #aEffort").value=a[11],document.querySelector("#progressForm #percentACompleted").value=100*a[12],document.querySelector("#progressForm #aReleaseDate").value=t(a[13])):n("không tìm thấy thông tin: "+e,"danger")}))})).catch((function(e){console.log(e)}))}function l(){var e=document.getElementById("accountSelect").value,t=document.getElementById("fullnameDisplay");e?Excel.run((function(n){var a=n.workbook.worksheets.getItem("Resource").tables.getItem("TblResource").getRange();return a.load("values"),n.sync().then((function(){for(var n=a.values,r=n[0],o=1;o<n.length;o++)if(n[o][r.indexOf("Account")]===e)return t.innerText=n[o][r.indexOf("Fullname")],void u();t.innerText=""}))})).catch((function(e){console.log("Error: "+e)})):(t.innerText="",u())}function u(){var e=document.getElementById("accountSelect").value;Excel.run((function(t){var n=t.workbook.worksheets.getItem("WBS").tables.getItem("TblWbs").getRange();return n.load("values"),t.sync().then((function(){var t=n.values,r={"Tổng nhiệm vụ":[],"Task đang làm":[],"Task chưa làm":[],"Task chờ review":[],"Task chờ release":[],"Task đã release":[]};t.forEach((function(t){var n=t[3].trim().toLowerCase(),a=t[12];n===e.trim().toLowerCase()&&(r["Tổng nhiệm vụ"].push(t),a>0&&a<.8?r["Task đang làm"].push(t):0===a?r["Task chưa làm"].push(t):.8===a?r["Task chờ review"].push(t):.9===a?r["Task chờ release"].push(t):1===a&&r["Task đã release"].push(t)),""===e.trim().toLowerCase()&&(r["Tổng nhiệm vụ"].push(t),a>0&&a<.8?r["Task đang làm"].push(t):0===a?r["Task chưa làm"].push(t):.8===a?r["Task chờ review"].push(t):.9===a?r["Task chờ release"].push(t):1===a&&r["Task đã release"].push(t))}));var o,s,l,u,m,g,v,f=r["Tổng nhiệm vụ"].length,b=r["Task đang làm"].length,E=r["Task chưa làm"].length,p=r["Task chờ review"].length,I=r["Task chờ release"].length,h=r["Task đã release"].length;document.getElementById("totalTasksCount").innerText=f,document.getElementById("doingCount").innerText=b,document.getElementById("notDoneCount").innerText=E,document.getElementById("reviewCount").innerText=p,document.getElementById("releaseCount").innerText=I,document.getElementById("releasedCount").innerText=h,document.getElementById("taskProgressBar").innerHTML=(l=b,u=p,m=I,g=h,v="\n      <div class='progress-bar progress-bar-striped bg-danger'\n           role='progressbar'\n           style='width: ".concat((s=E)/(o=f)*100,"%'\n           aria-valuenow='").concat(s/o*100,"'\n           aria-valuemin='0'\n           aria-valuemax='100'>\n          ").concat((s/o*100).toFixed(2),"%\n      </div>\n"),v+="\n      <div class='progress-bar progress-bar-striped bg-warning'\n           role='progressbar'\n           style='width: ".concat(l/o*100,"%'\n           aria-valuenow='").concat(l/o*100,"'\n           aria-valuemin='0'\n           aria-valuemax='100'>\n          ").concat((l/o*100).toFixed(2),"%\n      </div>\n"),v+="\n<div class='progress-bar progress-bar-striped bg-warning'\n     role='progressbar'\n     style='width: ".concat(u/o*100,"%'\n     aria-valuenow='").concat(u/o*100,"'\n     aria-valuemin='0'\n     aria-valuemax='100'>\n    ").concat((u/o*100).toFixed(2),"%\n</div>\n"),v+="\n<div class='progress-bar progress-bar-striped bg-warning'\n     role='progressbar'\n     style='width: ".concat(m/o*100,"%'\n     aria-valuenow='").concat(m/o*100,"'\n     aria-valuemin='0'\n     aria-valuemax='100'>\n    ").concat((m/o*100).toFixed(2),"%\n</div>\n"),v+="\n<div class='progress-bar progress-bar-striped bg-success'\n     role='progressbar'\n     style='width: ".concat(g/o*100,"%'\n     aria-valuenow='").concat(g/o*100,"'\n     aria-valuemin='0'\n     aria-valuemax='100'>\n    ").concat((g/o*100).toFixed(2),"%\n</div>\n")),document.getElementById("notDoneTasks").innerHTML=i(r["Task chưa làm"],a.OPEN),document.getElementById("doingTasks").innerHTML=i(r["Task đang làm"],a.IN_PROGRESS),document.getElementById("reviewTasks").innerHTML=i(r["Task chờ review"],a.WAITING_REVIEW),document.getElementById("releaseTasks").innerHTML=i(r["Task chờ release"],a.WAITING_RELEASE),document.getElementById("releasedTasks").innerHTML=i(r["Task đã release"]),document.querySelectorAll(".openModal").forEach((function(e){e.addEventListener("click",(function(e){e.preventDefault();var t=this.getAttribute("data-taskid");document.getElementById("progressTaskID").value=t,c(t),new bootstrap.Modal(document.getElementById("updateProgressModal")).show()}))})),d(a.OPEN),d(a.IN_PROGRESS),d(a.WAITING_REVIEW),d(a.WAITING_RELEASE)}))})).catch((function(e){console.error("Error retrieving tasks:",e)}))}function i(e,n){if(0===e.length)return"<p>No tasks available.</p>";var r=function(e){var t=["TaskID","P.StartDate","P.EndDate","P.Effort","PIC","Reviewer"];return e!==a.OPEN&&t.push("A.StartDate","A.EndDate","A.Effort","%A.Completed"),[a.OPEN,a.IN_PROGRESS,a.WAITING_REVIEW,a.WAITING_RELEASE].includes(e)&&t.push("Action"),t.map((function(e){return"<th>".concat(e,"</th>")}))}(n),s=e.map((function(e){return function(e,n){var r=['<td><a href="#" class="openModal link-info" data-taskid="'.concat(e[0],'">').concat(e[0],"</a></td>"),"<td>".concat(t(e[5]),"</td>"),"<td>".concat(t(e[6]),"</td>"),"<td>".concat(e[8],"</td>"),"<td>".concat(e[3],"</td>"),"<td>".concat(e[4],"</td>")];return n!==a.OPEN&&r.push("<td>".concat(t(e[9]),"</td>"),"<td>".concat(t(e[10]),"</td>"),"<td>".concat(e[11],"</td>"),"<td>".concat(100*e[12],"%</td>")),r.push(function(e,t){var n=o(o(o(o({},a.OPEN,'<button class="btn btn-sm btn-primary btn-task-start" data-taskid="'.concat(e,'">Start</button>')),a.IN_PROGRESS,'<button class="btn btn-sm btn-primary btn-task-inprogress" data-taskid="'.concat(e,'">Completed</button>')),a.WAITING_REVIEW,'<button class="btn btn-sm btn-primary btn-task-review" data-taskid="'.concat(e,'">Pass</button>')),a.WAITING_RELEASE,'<button class="btn btn-sm btn-primary btn-task-release" data-taskid="'.concat(e,'">Release</button>'));return n[t]?"<td>".concat(n[t],"</td>"):""}(e[0],n)),"<tr>".concat(r.join(""),"</tr>")}(e,n)}));return"\n    <table class='table table-bordered'>\n      <thead>\n        <tr>".concat(r.join(""),"</tr>\n      </thead>\n      <tbody>\n        ").concat(s.join(""),"\n      </tbody>\n    </table>\n  ")}function d(e){var t=o(o(o(o({},a.OPEN,{elementId:"notDoneTasks",buttonClass:"btn-task-start",message:"has been started"}),a.IN_PROGRESS,{elementId:"doingTasks",buttonClass:"btn-task-inprogress",message:"has been completed"}),a.WAITING_REVIEW,{elementId:"reviewTasks",buttonClass:"btn-task-review",message:"has been passed review"}),a.WAITING_RELEASE,{elementId:"releaseTasks",buttonClass:"btn-task-release",message:"has been released"})[e];t&&document.getElementById(t.elementId).addEventListener("click",(function(e){if(e.target&&e.target.classList.contains(t.buttonClass)){var a=e.target.getAttribute("data-taskid");n("Task ".concat(a," ").concat(t.message,"."),"success")}}))}Office.onReady((function(t){t.host===Office.HostType.Excel&&(Excel.run((function(e){var t=e.workbook.worksheets.getItem("Resource").tables.getItem("TblResource").getRange();return t.load("values"),e.sync().then((function(){for(var e=t.values,n=document.getElementById("accountSelect"),a=e[0].indexOf("Account"),r=1;r<e.length;r++){var o=e[r][a],s=document.createElement("option");s.value=o,s.text=o,n.appendChild(s)}}))})).catch((function(e){console.log("Error: "+e)})),u(),document.getElementById("accountSelect").onchange=l,document.getElementById("btnUpdateProgress").addEventListener("click",(function(){var t=document.getElementById("progressTaskID").value,a={startDate:document.getElementById("aStartDate").value,endDate:document.getElementById("aEndDate").value,effort:document.getElementById("aEffort").value,percentCompleted:document.getElementById("percentACompleted").value,releaseDate:document.getElementById("aReleaseDate").value};c(t),function(t,a){Excel.run((function(r){var o=r.workbook.worksheets.getItem("WBS").tables.getItem("TblWbs").getDataBodyRange();return o.load("values"),r.sync().then((function(){var c,l=o.values,u=l.findIndex((function(e){return e[0]===t}));if(-1!==u){var i=function(e){if(Array.isArray(e))return s(e)}(c=l[u])||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(c)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(c)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();return i[9]=e(a.startDate),i[10]=e(a.endDate),i[11]=a.effort,i[12]=a.percentCompleted/100,i[13]=e(a.releaseDate),o.getRow(u).values=[i],r.sync().then((function(){n("Update Successfully","success")}))}n("Không tìm thấy thông tin: "+t,"danger")}))})).catch((function(e){console.log(e),n("Error updating task details: "+e.message,"danger")}))}(t,a);var r=document.getElementById("updateProgressModal"),o=bootstrap.Modal.getInstance(r);o?o.hide():new bootstrap.Modal(r).hide()})),document.getElementById("updateProgressModal").addEventListener("hidden.bs.modal",(function(){console.log("Modal đã đóng.")})),document.addEventListener("DOMContentLoaded",(function(){var e,t;e=(new Date).toISOString().split("T")[0],(t=document.getElementById("logworkForm_date"))?t.value=e:console.warn("Logwork date input field not found")})))}))}()}();
//# sourceMappingURL=taskbymember.js.map