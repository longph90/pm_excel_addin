!function(){"use strict";!function(){function e(e){var t=new Date(e);return 25569+(t.getTime()-60*t.getTimezoneOffset()*1e3)/864e5}function t(e){return!e||isNaN(e)?"":new Date(86400*(e-25569)*1e3).toISOString().split("T")[0]}function n(e,t){var n=document.getElementById("notification");n.textContent=e,n.className="alert alert-".concat(t," position-fixed bottom-0 start-50 translate-middle-x mb-3"),n.classList.remove("d-none"),setTimeout((function(){n.classList.add("d-none")}),3e3)}var a=Object.freeze({OPEN:"OPEN",IN_PROGRESS:"IN_PROGRESS",WAITING_REVIEW:"WAITING_REVIEW",WAITING_RELEASE:"WAITING_RELEASE",RELEASED:"RELEASED"});function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t,n){return(t=function(e){var t=function(e){if("object"!=r(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==r(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function c(e){Excel.run((function(a){var r=a.workbook.worksheets.getItem("WBS").tables.getItem("TblWbs").getDataBodyRange();return r.load("values"),a.sync().then((function(){var a=r.values.find((function(t){return t[0]===e}));a?(document.querySelector("#progressForm #progressTaskID").value=e,document.querySelector("#progressForm #aStartDate").value=t(a[9]),document.querySelector("#progressForm #aEndDate").value=t(a[10]),document.querySelector("#progressForm #aEffort").value=a[11],document.querySelector("#progressForm #percentACompleted").value=100*a[12],document.querySelector("#progressForm #aReleaseDate").value=t(a[13])):n("kh√¥ng t√¨m th·∫•y th√¥ng tin: "+e,"danger")}))})).catch((function(e){console.log(e)}))}function l(){var e=document.getElementById("accountSelect").value,t=document.getElementById("fullnameDisplay");e?Excel.run((function(n){var a=n.workbook.worksheets.getItem("Resource").tables.getItem("TblResource").getRange();return a.load("values"),n.sync().then((function(){for(var n=a.values,r=n[0],o=1;o<n.length;o++)if(n[o][r.indexOf("Account")]===e)return t.innerText=n[o][r.indexOf("Fullname")],void i();t.innerText=""}))})).catch((function(e){console.log("Error: "+e)})):(t.innerText="",i())}function i(){var e=document.getElementById("accountSelect").value;Excel.run((function(t){var n=t.workbook.worksheets.getItem("WBS").tables.getItem("TblWbs").getRange();return n.load("values"),t.sync().then((function(){var t=n.values,r={"T·ªïng nhi·ªám v·ª•":[],"Task ƒëang l√†m":[],"Task ch∆∞a l√†m":[],"Task ch·ªù review":[],"Task ch·ªù release":[],"Task ƒë√£ release":[]};t.forEach((function(t){var n=t[3].trim().toLowerCase(),a=t[12];n===e.trim().toLowerCase()&&(r["T·ªïng nhi·ªám v·ª•"].push(t),a>0&&a<.8?r["Task ƒëang l√†m"].push(t):0===a?r["Task ch∆∞a l√†m"].push(t):.8===a?r["Task ch·ªù review"].push(t):.9===a?r["Task ch·ªù release"].push(t):1===a&&r["Task ƒë√£ release"].push(t)),""===e.trim().toLowerCase()&&(r["T·ªïng nhi·ªám v·ª•"].push(t),a>0&&a<.8?r["Task ƒëang l√†m"].push(t):0===a?r["Task ch∆∞a l√†m"].push(t):.8===a?r["Task ch·ªù review"].push(t):.9===a?r["Task ch·ªù release"].push(t):1===a&&r["Task ƒë√£ release"].push(t))}));var o,s,l,i,m,g,v,f=r["T·ªïng nhi·ªám v·ª•"].length,E=r["Task ƒëang l√†m"].length,p=r["Task ch∆∞a l√†m"].length,b=r["Task ch·ªù review"].length,I=r["Task ch·ªù release"].length,h=r["Task ƒë√£ release"].length;document.getElementById("totalTasksCount").innerText=f,document.getElementById("doingCount").innerText=E,document.getElementById("notDoneCount").innerText=p,document.getElementById("reviewCount").innerText=b,document.getElementById("releaseCount").innerText=I,document.getElementById("releasedCount").innerText=h,document.getElementById("taskProgressBar").innerHTML=(l=E,i=b,m=I,g=h,v="\n      <div class='progress-bar progress-bar-striped bg-danger'\n           role='progressbar'\n           style='width: ".concat((s=p)/(o=f)*100,"%'\n           aria-valuenow='").concat(s/o*100,"'\n           aria-valuemin='0'\n           aria-valuemax='100'>\n          ").concat((s/o*100).toFixed(2),"%\n      </div>\n"),v+="\n      <div class='progress-bar progress-bar-striped bg-warning'\n           role='progressbar'\n           style='width: ".concat(l/o*100,"%'\n           aria-valuenow='").concat(l/o*100,"'\n           aria-valuemin='0'\n           aria-valuemax='100'>\n          ").concat((l/o*100).toFixed(2),"%\n      </div>\n"),v+="\n<div class='progress-bar progress-bar-striped bg-warning'\n     role='progressbar'\n     style='width: ".concat(i/o*100,"%'\n     aria-valuenow='").concat(i/o*100,"'\n     aria-valuemin='0'\n     aria-valuemax='100'>\n    ").concat((i/o*100).toFixed(2),"%\n</div>\n"),v+="\n<div class='progress-bar progress-bar-striped bg-warning'\n     role='progressbar'\n     style='width: ".concat(m/o*100,"%'\n     aria-valuenow='").concat(m/o*100,"'\n     aria-valuemin='0'\n     aria-valuemax='100'>\n    ").concat((m/o*100).toFixed(2),"%\n</div>\n"),v+="\n<div class='progress-bar progress-bar-striped bg-success'\n     role='progressbar'\n     style='width: ".concat(g/o*100,"%'\n     aria-valuenow='").concat(g/o*100,"'\n     aria-valuemin='0'\n     aria-valuemax='100'>\n    ").concat((g/o*100).toFixed(2),"%\n</div>\n")),document.getElementById("notDoneTasks").innerHTML=u(r["Task ch∆∞a l√†m"],a.OPEN),document.getElementById("doingTasks").innerHTML=u(r["Task ƒëang l√†m"],a.IN_PROGRESS),document.getElementById("reviewTasks").innerHTML=u(r["Task ch·ªù review"],a.WAITING_REVIEW),document.getElementById("releaseTasks").innerHTML=u(r["Task ch·ªù release"],a.WAITING_RELEASE),document.getElementById("releasedTasks").innerHTML=u(r["Task ƒë√£ release"]),document.querySelectorAll(".openModal").forEach((function(e){e.addEventListener("click",(function(e){e.preventDefault();var t=this.getAttribute("data-taskid");document.getElementById("progressTaskID").value=t,c(t),new bootstrap.Modal(document.getElementById("updateProgressModal")).show()}))})),d(a.OPEN),d(a.IN_PROGRESS),d(a.WAITING_REVIEW),d(a.WAITING_RELEASE)}))})).catch((function(e){console.error("Error retrieving tasks:",e)}))}function u(e,n){if(0===e.length)return"<p>No tasks available.</p>";var r=function(e){var t=["TaskID","TaskName","P.StartDate","P.EndDate","P.Effort","PIC","Reviewer"];return e!==a.OPEN&&t.push("A.StartDate","A.EndDate","A.Effort","%A.Completed"),[a.OPEN,a.IN_PROGRESS,a.WAITING_REVIEW,a.WAITING_RELEASE].includes(e)&&t.push("Action"),t.map((function(e){return"<th>".concat(e,"</th>")}))}(n),s=e.map((function(e){return function(e,n){var r=['<td><a href="#" class="openModal link-info" data-taskid="'.concat(e[0],'">').concat(e[0],"</a></td>"),'<td><span class="d-inline-block text-truncate" style="max-width: 50px;">'.concat(e[1],"</span></td>"),"<td>".concat(t(e[5]),"</td>"),"<td>".concat(t(e[6]),"</td>"),"<td>".concat(e[8],"</td>"),"<td>".concat(e[3],"</td>"),"<td>".concat(e[4],"</td>")];return n!==a.OPEN&&r.push("<td>".concat(t(e[9]),"</td>"),"<td>".concat(t(e[10]),"</td>"),"<td>".concat(e[11],"</td>"),"<td>".concat(100*e[12],"%</td>")),r.push(function(e,t){var n=o(o(o(o({},a.OPEN,{class:"btn-task-start",icon:"‚ñ∂Ô∏è",tooltip:"Click To Start Task"}),a.IN_PROGRESS,{class:"btn-task-inprogress",icon:"‚úÖ",tooltip:"Mark as Completed"}),a.WAITING_REVIEW,{class:"btn-task-review",icon:"‚úÖ",tooltip:"Mark as Pass Review"}),a.WAITING_RELEASE,{class:"btn-task-release",icon:"üöÄ",tooltip:"Click To Release Task"})[t];return n?'\n    <td>\n      <button \n        class="btn btn-sm '.concat(n.class,'" \n        data-taskid="').concat(e,'" \n        title="').concat(n.tooltip,'"\n        data-toggle="tooltip" \n        data-placement="top"\n      >\n        ').concat(n.icon,"\n      </button>\n    </td>\n  "):""}(e[0],n)),"<tr>".concat(r.join(""),"</tr>")}(e,n)}));return"\n    <table class='table table-bordered'>\n      <thead>\n        <tr>".concat(r.join(""),"</tr>\n      </thead>\n      <tbody>\n        ").concat(s.join(""),"\n      </tbody>\n    </table>\n  ")}function d(e){var t=o(o(o(o({},a.OPEN,{elementId:"notDoneTasks",buttonClass:"btn-task-start",message:"has been started"}),a.IN_PROGRESS,{elementId:"doingTasks",buttonClass:"btn-task-inprogress",message:"has been completed"}),a.WAITING_REVIEW,{elementId:"reviewTasks",buttonClass:"btn-task-review",message:"has been passed review"}),a.WAITING_RELEASE,{elementId:"releaseTasks",buttonClass:"btn-task-release",message:"has been released"})[e];t&&document.getElementById(t.elementId).addEventListener("click",(function(e){if(e.target&&e.target.classList.contains(t.buttonClass)){var a=e.target.getAttribute("data-taskid");n("Task ".concat(a," ").concat(t.message,"."),"success")}}))}Office.onReady((function(t){t.host===Office.HostType.Excel&&(Excel.run((function(e){var t=e.workbook.worksheets.getItem("Resource").tables.getItem("TblResource").getRange();return t.load("values"),e.sync().then((function(){for(var e=t.values,n=document.getElementById("accountSelect"),a=e[0].indexOf("Account"),r=1;r<e.length;r++){var o=e[r][a],s=document.createElement("option");s.value=o,s.text=o,n.appendChild(s)}}))})).catch((function(e){console.log("Error: "+e)})),i(),document.getElementById("accountSelect").onchange=l,document.getElementById("btnUpdateProgress").addEventListener("click",(function(){var t=document.getElementById("progressTaskID").value,a={startDate:document.getElementById("aStartDate").value,endDate:document.getElementById("aEndDate").value,effort:document.getElementById("aEffort").value,percentCompleted:document.getElementById("percentACompleted").value,releaseDate:document.getElementById("aReleaseDate").value};c(t),function(t,a){Excel.run((function(r){var o=r.workbook.worksheets.getItem("WBS").tables.getItem("TblWbs").getDataBodyRange();return o.load("values"),r.sync().then((function(){var c,l=o.values,i=l.findIndex((function(e){return e[0]===t}));if(-1!==i){var u=function(e){if(Array.isArray(e))return s(e)}(c=l[i])||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(c)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(c)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();return u[9]=e(a.startDate),u[10]=e(a.endDate),u[11]=a.effort,u[12]=a.percentCompleted/100,u[13]=e(a.releaseDate),o.getRow(i).values=[u],r.sync().then((function(){n("Update Successfully","success")}))}n("Kh√¥ng t√¨m th·∫•y th√¥ng tin: "+t,"danger")}))})).catch((function(e){console.log(e),n("Error updating task details: "+e.message,"danger")}))}(t,a);var r=document.getElementById("updateProgressModal"),o=bootstrap.Modal.getInstance(r);o?o.hide():new bootstrap.Modal(r).hide()})),document.getElementById("updateProgressModal").addEventListener("hidden.bs.modal",(function(){console.log("Modal ƒë√£ ƒë√≥ng.")})),document.addEventListener("DOMContentLoaded",(function(){var e,t;e=(new Date).toISOString().split("T")[0],(t=document.getElementById("logworkForm_date"))?t.value=e:console.warn("Logwork date input field not found")})))}))}()}();
//# sourceMappingURL=taskbymember.js.map