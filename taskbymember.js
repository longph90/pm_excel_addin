!function(){"use strict";!function(){function e(e){var t=new Date(e);return 25569+(t.getTime()-60*t.getTimezoneOffset()*1e3)/864e5}function t(e){return!e||isNaN(e)?"":new Date(86400*(e-25569)*1e3).toISOString().split("T")[0]}function n(e,t){var n=document.getElementById("notification");n.textContent=e,n.className="alert alert-".concat(t," position-fixed bottom-0 start-50 translate-middle-x mb-3"),n.classList.remove("d-none"),setTimeout((function(){n.classList.add("d-none")}),3e3)}var a=Object.freeze({OPEN:"OPEN",IN_PROGRESS:"IN_PROGRESS",WAITING_REVIEW:"WAITING_REVIEW",WAITING_RELEASE:"WAITING_RELEASE",RELEASED:"RELEASED"});function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t,n){return(t=function(e){var t=function(e){if("object"!=r(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==r(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,o,s,c=[],l=!0,i=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(a=o.call(n)).done)&&(c.push(a.value),c.length!==t);l=!0);}catch(e){i=!0,r=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(i)throw r}}return c}}(e,t)||l(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||l(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){if(e){if("string"==typeof e)return i(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function u(e){Excel.run((function(a){var r=a.workbook.worksheets.getItem("WBS").tables.getItem("TblWbs").getDataBodyRange();r.load("values");var o=a.workbook.worksheets.getItem("Setting").getRange("B3");return o.load("values"),a.sync().then((function(){var a=r.values.find((function(t){return t[0]===e}));if(a){document.querySelector("#progressForm #progressTaskID").value=e;var s=document.querySelector("#linkToBack"),c=o.values[0][0];s.href="".concat(c).concat(e),s.textContent="Open Backlog",s.target="_blank",s.rel="noopener noreferrer",document.querySelector("#progressForm #aStartDate").value=t(a[9]),document.querySelector("#progressForm #aEndDate").value=t(a[10]),document.querySelector("#progressForm #aEffort").value=a[11],document.querySelector("#progressForm #percentACompleted").value=100*a[12],document.querySelector("#progressForm #aReleaseDate").value=t(a[13])}else n("kh√¥ng t√¨m th·∫•y th√¥ng tin: "+e,"danger")}))})).catch((function(e){console.log(e)}))}function d(){var e=document.getElementById("accountSelect").value,t=document.getElementById("fullnameDisplay");e?Excel.run((function(n){var a=n.workbook.worksheets.getItem("Resource").tables.getItem("TblResource").getRange();return a.load("values"),n.sync().then((function(){for(var n=a.values,r=n[0],o=1;o<n.length;o++)if(n[o][r.indexOf("Account")]===e)return t.innerText=n[o][r.indexOf("Fullname")],void g();t.innerText=""}))})).catch((function(e){console.log("Error: "+e)})):(t.innerText="",g())}function g(){var e=document.getElementById("accountSelect").value.trim().toLowerCase();Excel.run((function(n){var r=n.workbook.worksheets.getItem("WBS").tables.getItem("TblWbs").getRange();return r.load("values"),n.sync().then((function(){var n=function(e,t){var n={"T·ªïng nhi·ªám v·ª•":[],"Task doing":[],"Task notDone":[],"Task review":[],"Task release":[],"Task released":[]};return e.forEach((function(e){var a=e[3].trim().toLowerCase(),r=e[4].trim().toLowerCase(),o=e[12];(function(e,t,n){return""===n||e===n||t===n})(a,r,t)&&function(e,t,n){n["T·ªïng nhi·ªám v·ª•"].push(e),t>0&&t<.8?n["Task doing"].push(e):0===t?n["Task notDone"].push(e):.8===t?n["Task review"].push(e):.9===t?n["Task release"].push(e):1===t&&n["Task released"].push(e)}(e,o,n)})),n}(r.values,e);!function(e){var n={total:e["T·ªïng nhi·ªám v·ª•"].length,doing:e["Task doing"].length,notDone:e["Task notDone"].length,review:e["Task review"].length,release:e["Task release"].length,released:e["Task released"].length};(function(e){Object.entries(e).forEach((function(e){var t=s(e,2),n=t[0],a=t[1],r=document.getElementById("".concat(n,"Count"));r?r.innerText=a:console.warn('Element with id "'.concat(n,'Count" not found'))}))})(n),function(e){var t,n,a,r,o,s,c;document.getElementById("taskProgressBar").innerHTML=(a=e.doing,r=e.review,o=e.release,s=e.released,c="\n      <div class='progress-bar progress-bar-striped bg-danger'\n           role='progressbar'\n           style='width: ".concat((n=e.notDone)/(t=e.total)*100,"%'\n           aria-valuenow='").concat(n/t*100,"'\n           aria-valuemin='0'\n           aria-valuemax='100'>\n          ").concat((n/t*100).toFixed(2),"%\n      </div>\n"),c+="\n      <div class='progress-bar progress-bar-striped bg-warning'\n           role='progressbar'\n           style='width: ".concat(a/t*100,"%'\n           aria-valuenow='").concat(a/t*100,"'\n           aria-valuemin='0'\n           aria-valuemax='100'>\n          ").concat((a/t*100).toFixed(2),"%\n      </div>\n"),c+="\n<div class='progress-bar progress-bar-striped bg-warning'\n     role='progressbar'\n     style='width: ".concat(r/t*100,"%'\n     aria-valuenow='").concat(r/t*100,"'\n     aria-valuemin='0'\n     aria-valuemax='100'>\n    ").concat((r/t*100).toFixed(2),"%\n</div>\n"),c+="\n<div class='progress-bar progress-bar-striped bg-warning'\n     role='progressbar'\n     style='width: ".concat(o/t*100,"%'\n     aria-valuenow='").concat(o/t*100,"'\n     aria-valuemin='0'\n     aria-valuemax='100'>\n    ").concat((o/t*100).toFixed(2),"%\n</div>\n"),c+="\n<div class='progress-bar progress-bar-striped bg-success'\n     role='progressbar'\n     style='width: ".concat(s/t*100,"%'\n     aria-valuenow='").concat(s/t*100,"'\n     aria-valuemin='0'\n     aria-valuemax='100'>\n    ").concat((s/t*100).toFixed(2),"%\n</div>\n"))}(n),function(e){var n={notDoneTasks:a.OPEN,doingTasks:a.IN_PROGRESS,reviewTasks:a.WAITING_REVIEW,releaseTasks:a.WAITING_RELEASE,releasedTasks:null};Object.entries(n).forEach((function(n){var r=s(n,2),c=r[0],l=r[1],i=c.replace("Tasks","");document.getElementById(c).innerHTML=function(e,n){if(0===e.length)return"<p>No tasks available.</p>";var r=function(e){var t=["TaskID","TaskName","P.StartDate","P.EndDate","P.Effort","PIC","Reviewer"];return e!==a.OPEN&&t.push("A.Effort","%A.Completed"),[a.OPEN,a.IN_PROGRESS,a.WAITING_REVIEW,a.WAITING_RELEASE].includes(e)&&t.push("Action"),t.map((function(e){return"<th>".concat(e,"</th>")}))}(n),s=e.map((function(e){return function(e,n){var r=['<td><a href="#" class="openModal link-info" data-taskid="'.concat(e[0],'">').concat(e[0],"</a></td>"),'<td><span class="d-inline-block text-truncate" style="max-width: 50px;">'.concat(e[1],"</span></td>"),"<td>".concat(t(e[5]),"</td>"),"<td>".concat(t(e[6]),"</td>"),"<td>".concat(e[8],"</td>"),"<td>".concat(e[3],"</td>"),"<td>".concat(e[4],"</td>")];return n!==a.OPEN&&r.push("<td>".concat(e[11],"</td>"),"<td>".concat(100*e[12],"%</td>")),r.push(function(e,t){var n=o(o(o(o({},a.OPEN,{class:"btn-task-start",icon:"‚ñ∂Ô∏è",tooltip:"Click To Start Task"}),a.IN_PROGRESS,{class:"btn-task-inprogress",icon:"‚úÖ",tooltip:"Mark as Completed"}),a.WAITING_REVIEW,{class:"btn-task-review",icon:"‚úÖ",tooltip:"Mark as Pass Review"}),a.WAITING_RELEASE,{class:"btn-task-release",icon:"üöÄ",tooltip:"Click To Release Task"})[t];return n?'\n    <td>\n      <button \n        class="btn btn-sm '.concat(n.class,'" \n        data-taskid="').concat(e,'" \n        title="').concat(n.tooltip,'"\n        data-toggle="tooltip" \n        data-placement="top"\n      >\n        ').concat(n.icon,"\n      </button>\n    </td>\n  "):""}(e[0],n)),"<tr>".concat(r.join(""),"</tr>")}(e,n)}));return"\n    <table class='table table-bordered'>\n      <thead>\n        <tr>".concat(r.join(""),"</tr>\n      </thead>\n      <tbody>\n        ").concat(s.join(""),"\n      </tbody>\n    </table>\n  ")}(e["Task ".concat(i)],l)}))}(e),function(){var e=document.querySelectorAll(".openModal"),t=document.getElementById("updateProgressModal"),n=document.getElementById("progressTaskID");function a(e){e.preventDefault();var a=this.getAttribute("data-taskid");n.value=a,u(a),new bootstrap.Modal(t).show()}e.forEach((function(e){e.addEventListener("click",a)}))}(),[a.OPEN,a.IN_PROGRESS,a.WAITING_REVIEW,a.WAITING_RELEASE].forEach(f)}(n)}))})).catch((function(e){console.error("Error retrieving tasks:",e),n("Error retrieving tasks:"+e,"danger")}))}function f(t){var r=o(o(o(o({},a.OPEN,{elementId:"notDoneTasks",buttonClass:"btn-task-start",completionPercentage:.1,updateField:{index:9,value:"A.StartDate"}}),a.IN_PROGRESS,{elementId:"doingTasks",buttonClass:"btn-task-inprogress",completionPercentage:.8}),a.WAITING_REVIEW,{elementId:"reviewTasks",buttonClass:"btn-task-review",completionPercentage:.9,updateField:{index:10,value:"A.EndDate"}}),a.WAITING_RELEASE,{elementId:"releaseTasks",buttonClass:"btn-task-release",completionPercentage:1,updateField:{index:13,value:"A.ReleaseDate"}})[t];r&&document.getElementById(r.elementId).addEventListener("click",(function(t){t.target&&t.target.classList.contains(r.buttonClass)&&function(t,n){return Excel.run((function(a){var r=a.workbook.tables.getItem("TblWbs").getDataBodyRange();return r.load("values"),a.sync().then((function(){var o=r.values,s=o.findIndex((function(e){return e[0]===t}));if(-1!==s){var l=c(o[s]);if(l[12]=n.completionPercentage,n.updateField){var i=(new Date).toISOString().split("T")[0];l[n.updateField.index]=e(i)}r.getRow(s).values=[l]}return a.sync()}))}))}(t.target.getAttribute("data-taskid"),r).then((function(){d(),n("Task updated successfully!","success")})).catch((function(e){console.log(e),n("Error: ".concat(e.message),"danger")}))}))}Office.onReady((function(t){t.host===Office.HostType.Excel&&(Excel.run((function(e){var t=e.workbook.worksheets.getItem("Resource").tables.getItem("TblResource").getRange();return t.load("values"),e.sync().then((function(){for(var e=t.values,n=document.getElementById("accountSelect"),a=e[0].indexOf("Account"),r=1;r<e.length;r++){var o=e[r][a],s=document.createElement("option");s.value=o,s.text=o,n.appendChild(s)}}))})).catch((function(e){console.log("Error: "+e)})),g(),document.getElementById("accountSelect").onchange=d,document.getElementById("btnUpdateProgress").addEventListener("click",(function(){var t=document.getElementById("progressTaskID").value,a={startDate:document.getElementById("aStartDate").value,endDate:document.getElementById("aEndDate").value,effort:document.getElementById("aEffort").value,percentCompleted:document.getElementById("percentACompleted").value,releaseDate:document.getElementById("aReleaseDate").value};u(t),function(t,a){Excel.run((function(r){var o=r.workbook.worksheets.getItem("WBS").tables.getItem("TblWbs").getDataBodyRange();return o.load("values"),r.sync().then((function(){var s=o.values,l=s.findIndex((function(e){return e[0]===t}));if(-1!==l){var i=c(s[l]);return i[9]=e(a.startDate),i[10]=e(a.endDate),i[11]=a.effort,i[12]=a.percentCompleted/100,i[13]=e(a.releaseDate),o.getRow(l).values=[i],r.sync().then((function(){n("Update Successfully","success")}))}n("Kh√¥ng t√¨m th·∫•y th√¥ng tin: "+t,"danger")}))})).catch((function(e){console.log(e),n("Error updating task details: "+e.message,"danger")}))}(t,a);var r=document.getElementById("updateProgressModal"),o=bootstrap.Modal.getInstance(r);o?o.hide():new bootstrap.Modal(r).hide()})),document.getElementById("updateProgressModal").addEventListener("hidden.bs.modal",(function(){console.log("Modal ƒë√£ ƒë√≥ng.")})),document.addEventListener("DOMContentLoaded",(function(){var e,t;e=(new Date).toISOString().split("T")[0],(t=document.getElementById("logworkForm_date"))?t.value=e:console.warn("Logwork date input field not found")})))}))}()}();
//# sourceMappingURL=taskbymember.js.map