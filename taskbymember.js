!function(){function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function t(e){Excel.run((function(t){var n=t.workbook.worksheets.getItem("WBS").tables.getItem("TblWbs").getDataBodyRange();return n.load("values"),t.sync().then((function(){var t=n.values.find((function(t){return t[0]===e}));t?(document.querySelector("#progressForm #progressTaskID").value=e,document.querySelector("#progressForm #aStartDate").value=s(t[9]),document.querySelector("#progressForm #aEndDate").value=s(t[10]),document.querySelector("#progressForm #aEffort").value=t[11],document.querySelector("#progressForm #percentACompleted").value=100*t[12],document.querySelector("#progressForm #aReleaseDate").value=s(t[13])):o("không tìm thấy thông tin: "+e,"danger")}))})).catch((function(e){console.log(e)}))}function n(){var e=document.getElementById("accountSelect").value,t=document.getElementById("fullnameDisplay");e?Excel.run((function(n){var r=n.workbook.worksheets.getItem("Resource").tables.getItem("TblResource").getRange();return r.load("values"),n.sync().then((function(){for(var n=r.values,o=n[0],s=1;s<n.length;s++)if(n[s][o.indexOf("Account")]===e)return t.innerText=n[s][o.indexOf("Fullname")],void a();t.innerText=""}))})).catch((function(e){console.log("Error: "+e)})):(t.innerText="",a())}function a(){var e=document.getElementById("accountSelect").value;Excel.run((function(n){var a=n.workbook.worksheets.getItem("WBS").tables.getItem("TblWbs").getRange();return a.load("values"),n.sync().then((function(){var n=a.values,o={"Tổng nhiệm vụ":[],"Task đang làm":[],"Task chưa làm":[],"Task chờ review":[],"Task chờ release":[],"Task đã release":[]};n.forEach((function(t){var n=t[3].trim().toLowerCase(),a=t[12];n===e.trim().toLowerCase()&&(o["Tổng nhiệm vụ"].push(t),a>0&&a<.8?o["Task đang làm"].push(t):0===a?o["Task chưa làm"].push(t):.8===a?o["Task chờ review"].push(t):.9===a?o["Task chờ release"].push(t):1===a&&o["Task đã release"].push(t)),""===e.trim().toLowerCase()&&(o["Tổng nhiệm vụ"].push(t),a>0&&a<.8?o["Task đang làm"].push(t):0===a?o["Task chưa làm"].push(t):.8===a?o["Task chờ review"].push(t):.9===a?o["Task chờ release"].push(t):1===a&&o["Task đã release"].push(t))}));var s,c,l,u,d,i,m,g=o["Tổng nhiệm vụ"].length,h=o["Task đang làm"].length,v=o["Task chưa làm"].length,f=o["Task chờ review"].length,p=o["Task chờ release"].length,y=o["Task đã release"].length;document.getElementById("totalTasksCount").innerText=g,document.getElementById("doingCount").innerText=h,document.getElementById("notDoneCount").innerText=v,document.getElementById("reviewCount").innerText=f,document.getElementById("releaseCount").innerText=p,document.getElementById("releasedCount").innerText=y,document.getElementById("taskProgressBar").innerHTML=(l=h,u=f,d=p,i=y,m="\n      <div class='progress-bar progress-bar-striped bg-danger'\n           role='progressbar'\n           style='width: ".concat((c=v)/(s=g)*100,"%'\n           aria-valuenow='").concat(c/s*100,"'\n           aria-valuemin='0'\n           aria-valuemax='100'>\n          ").concat((c/s*100).toFixed(2),"%\n      </div>\n"),m+="\n      <div class='progress-bar progress-bar-striped bg-warning'\n           role='progressbar'\n           style='width: ".concat(l/s*100,"%'\n           aria-valuenow='").concat(l/s*100,"'\n           aria-valuemin='0'\n           aria-valuemax='100'>\n          ").concat((l/s*100).toFixed(2),"%\n      </div>\n"),m+="\n<div class='progress-bar progress-bar-striped bg-warning'\n     role='progressbar'\n     style='width: ".concat(u/s*100,"%'\n     aria-valuenow='").concat(u/s*100,"'\n     aria-valuemin='0'\n     aria-valuemax='100'>\n    ").concat((u/s*100).toFixed(2),"%\n</div>\n"),m+="\n<div class='progress-bar progress-bar-striped bg-warning'\n     role='progressbar'\n     style='width: ".concat(d/s*100,"%'\n     aria-valuenow='").concat(d/s*100,"'\n     aria-valuemin='0'\n     aria-valuemax='100'>\n    ").concat((d/s*100).toFixed(2),"%\n</div>\n"),m+="\n<div class='progress-bar progress-bar-striped bg-success'\n     role='progressbar'\n     style='width: ".concat(i/s*100,"%'\n     aria-valuenow='").concat(i/s*100,"'\n     aria-valuemin='0'\n     aria-valuemax='100'>\n    ").concat((i/s*100).toFixed(2),"%\n</div>\n")),document.getElementById("doingTasks").innerHTML=r(o["Task đang làm"]),document.getElementById("notDoneTasks").innerHTML=r(o["Task chưa làm"]),document.getElementById("reviewTasks").innerHTML=r(o["Task chờ review"]),document.getElementById("releaseTasks").innerHTML=r(o["Task chờ release"]),document.getElementById("releasedTasks").innerHTML=r(o["Task đã release"]),document.querySelectorAll(".openModal").forEach((function(e){e.addEventListener("click",(function(e){e.preventDefault();var n=this.getAttribute("data-taskid");document.getElementById("progressTaskID").value=n,t(n),new bootstrap.Modal(document.getElementById("updateProgressModal")).show()}))}))}))})).catch((function(e){console.error("Error retrieving tasks:",e)}))}function r(e){if(0===e.length)return"<p>No tasks available.</p>";var t="<table class='table table-bordered'>";return t+="<thead><tr>",t+="<th>TaskID</th><th>P.StartDate</th><th>P.EndDate</th><th>P.Effort</th>",t+="<th>A.StartDate</th><th>A.EndDate</th><th>A.Effort</th><th>%A.Completed</th>",t+="</tr></thead><tbody>",e.forEach((function(e){t+="<tr>",t+='<td><a href="#" class="openModal btn btn-info" data-taskid="'.concat(e[0],'">').concat(e[0],"</a></td>"),t+="<td>".concat(s(e[5]),"</td>"),t+="<td>".concat(s(e[6]),"</td>"),t+="<td>".concat(e[8],"</td>"),t+="<td>".concat(s(e[9]),"</td>"),t+="<td>".concat(s(e[10]),"</td>"),t+="<td>".concat(e[11],"</td>"),t+="<td>".concat(100*e[12],"%</td>"),t+="</tr>"})),t+="</tbody></table>"}function o(e,t){var n=document.getElementById("notification");n.textContent=e,n.className="alert alert-".concat(t," position-fixed bottom-0 start-50 translate-middle-x mb-3"),n.classList.remove("d-none"),setTimeout((function(){n.classList.add("d-none")}),3e3)}function s(e){return!e||isNaN(e)?"":new Date(86400*(e-25569)*1e3).toISOString().split("T")[0]}function c(e){var t=new Date(e);return 25569+(t.getTime()-60*t.getTimezoneOffset()*1e3)/864e5}Office.onReady((function(r){r.host===Office.HostType.Excel&&(Excel.run((function(e){var t=e.workbook.worksheets.getItem("Resource").tables.getItem("TblResource").getRange();return t.load("values"),e.sync().then((function(){for(var e=t.values,n=document.getElementById("accountSelect"),a=e[0],r=1;r<e.length;r++){var o=e[r][a.indexOf("Account")],s=document.createElement("option");s.value=o,s.text=o,n.appendChild(s)}}))})).catch((function(e){console.log("Error: "+e)})),a(),document.getElementById("accountSelect").onchange=n,document.getElementById("btnUpdateProgress").addEventListener("click",(function(){var n=document.getElementById("progressTaskID").value,a={startDate:document.getElementById("aStartDate").value,endDate:document.getElementById("aEndDate").value,effort:document.getElementById("aEffort").value,percentCompleted:document.getElementById("percentACompleted").value,releaseDate:document.getElementById("aReleaseDate").value};t(n),function(t,n){Excel.run((function(a){var r=a.workbook.worksheets.getItem("WBS").tables.getItem("TblWbs").getDataBodyRange();return r.load("values"),a.sync().then((function(){var s,l=r.values,u=l.findIndex((function(e){return e[0]===t}));if(-1!==u){var d=function(t){if(Array.isArray(t))return e(t)}(s=l[u])||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(s)||function(t,n){if(t){if("string"==typeof t)return e(t,n);var a={}.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?e(t,n):void 0}}(s)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();return d[9]=c(n.startDate),d[10]=c(n.endDate),d[11]=n.effort,d[12]=n.percentCompleted/100,d[13]=c(n.releaseDate),r.getRow(u).values=[d],a.sync().then((function(){o("Update Successfully","success")}))}o("Không tìm thấy thông tin: "+t,"danger")}))})).catch((function(e){console.log(e),o("Error updating task details: "+e.message,"danger")}))}(n,a);var r=document.getElementById("updateProgressModal"),s=bootstrap.Modal.getInstance(r);s?s.hide():new bootstrap.Modal(r).hide()})),document.getElementById("updateProgressModal").addEventListener("hidden.bs.modal",(function(){var e;e="ABC XYZ",Excel.run((function(t){return t.workbook.worksheets.getItem("WBS").getRange("A132").values=[[e]],t.sync().then((function(){console.log("Successfully wrote '"+e+"' to A132.")}))})).catch((function(e){console.error(e)})),console.log("Modal đã đóng.")})))}))}();
//# sourceMappingURL=taskbymember.js.map